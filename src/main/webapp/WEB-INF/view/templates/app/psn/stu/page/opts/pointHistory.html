<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/app/psn/stu/layouts/std_layout}" lang="ko">
<th:block layout:fragment="content">
    <script src="/files/script/libs/qrcode.min.js"></script>
    <script th:inline="javascript">

        // ë°ì´í„° ë¶€ë¶„
        const historyData = [
            {type: '+', category: 'attendance', title: 'ì£¼ì¼ ì¶œì„ ë³´ìƒ', date: '2025.02.02', amount: 100, balance: 2600},
            {type: '+', category: 'quest', title: 'ì¼ì¼ í€˜ìŠ¤íŠ¸ ì™„ë£Œ', date: '2025.02.02', amount: 50, balance: 2500},
            {type: '-', category: 'shop', title: 'ë‹¬ë€íŠ¸ ì‹œì¥ (í•™ìš©í’ˆ)', date: '2025.02.01', amount: -500, balance: 2450},
            {type: '+', category: 'event', title: 'ì„±ê²½ ì•”ì†¡ ëŒ€íšŒ', date: '2025.01.28', amount: 300, balance: 2950},
            {type: '+', category: 'food', title: 'ê°„ì‹ ë‚˜ëˆ”', date: '2025.01.28', amount: 50, balance: 2650},
            {type: '-', category: 'shop', title: 'ì¹œêµ¬ ì„ ë¬¼ êµ¬ë§¤', date: '2025.01.25', amount: -200, balance: 2600},
            {type: '+', category: 'attendance', title: 'ì£¼ì¼ ì¶œì„ ë³´ìƒ', date: '2025.01.26', amount: 100, balance: 2800},
            {type: '+', category: 'quest', title: 'ì„±ê²½ í•„ì‚¬ ì™„ë£Œ', date: '2025.01.25', amount: 150, balance: 2700},
            {type: '+', category: 'quest', title: 'ë¶€ëª¨ë‹˜ ì•ˆë§ˆ', date: '2025.01.24', amount: 50, balance: 2550},
            {type: '-', category: 'event', title: 'ì§€ê° ë²Œê¸ˆ', date: '2025.01.22', amount: -50, balance: 2500},
            {type: '+', category: 'attendance', title: 'ì£¼ì¼ ì¶œì„ ë³´ìƒ', date: '2025.01.19', amount: 100, balance: 2550},
            {type: '+', category: 'quest', title: 'íí‹°(QT) ì¸ì¦', date: '2025.01.18', amount: 30, balance: 2450},
            {type: '+', category: 'quest', title: 'íí‹°(QT) ì¸ì¦', date: '2025.01.17', amount: 30, balance: 2420},
            {type: '+', category: 'quest', title: 'íí‹°(QT) ì¸ì¦', date: '2025.01.16', amount: 30, balance: 2390},
            {type: '+', category: 'event', title: 'ì‹ ë…„ ê°ì‚¬ ì˜ˆë°°', date: '2025.01.01', amount: 500, balance: 2360},
            {type: '-', category: 'shop', title: 'ë–¡ë³¶ì´ íŒŒí‹°', date: '2024.12.31', amount: -1000, balance: 1860},
            {type: '+', category: 'attendance', title: 'ì†¡êµ¬ì˜ì‹  ì˜ˆë°°', date: '2024.12.31', amount: 200, balance: 2860},
            {type: '+', category: 'quest', title: 'ì „ë„ ì¶•ì œ ì¹œêµ¬ì´ˆì²­', date: '2024.12.25', amount: 1000, balance: 2660},
            {type: '+', category: 'attendance', title: 'ì„±íƒ„ì ˆ ì˜ˆë°°', date: '2024.12.25', amount: 200, balance: 1660},
            {type: '+', category: 'attendance', title: 'ì£¼ì¼ ì¶œì„ ë³´ìƒ', date: '2024.12.22', amount: 100, balance: 1460},
        ];

        const categoryIcons = {attendance: 'â›ª', quest: 'âš”ï¸', shop: 'ğŸ›’', food: 'ğŸ”', event: 'ğŸ‰', default: 'ğŸ’°'};
        let currentHistoryFilter = '*';
        let currentPage = 1;
        const itemsPerPage = 7;
        let filteredData = [];

        function setHistoryFilter(filterType) {
            currentHistoryFilter = filterType;
            currentPage = 1;
            $('.filter-tab').removeClass('active');
            $(`.filter-tab[onclick="setHistoryFilter('${filterType}')"]`).addClass('active');
            renderHistory(true);
        }

        function loadMoreHistory() {
            currentPage++;
            renderHistory(false);
        }

        function renderHistory(reset = false) {
            const $list = $('#point-history-list');
            const $btnMore = $('#btn-load-more');

            if (reset) {
                $list.empty();
                if (currentHistoryFilter === '*') filteredData = historyData;
                else filteredData = historyData.filter(item => item.type === currentHistoryFilter);
            }

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            if (filteredData.length === 0) {
                $list.html('<div class="empty-history text-light text-center" style="padding:20px;">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤. í……! ğŸ—‘ï¸</div>');
                $btnMore.hide();
                return;
            }

            let lastDate = null;
            if (!reset && $('.history-date-header').last().length > 0) {
                lastDate = $('.history-date-header').last().data('date');
            }

            pageData.forEach(item => {
                if (item.date !== lastDate) {
                    $list.append(`<div class="history-date-header" data-date="${item.date}" style="background: #f8f9fa; padding: 5px 10px; border-radius: 8px; display: inline-block; margin: 15px 5px 5px 5px; font-weight: bold; font-size: 0.75rem; color: #888;">${item.date}</div>`);
                    lastDate = item.date;
                }

                const isPlus = item.amount > 0;
                const colorClass = isPlus ? 'text-blue' : 'text-red';
                const amountStr = (isPlus ? '+' : '') + item.amount.toLocaleString();
                const iconChar = categoryIcons[item.category] || categoryIcons.default;

                const html = `
                <div class="menu-item" style="cursor: default;">
                    <div class="flex-row">
                        <div class="flex-center" style="width: 40px; height: 40px; background: #F8F9FA; border-radius: 12px; font-size: 1.2rem; margin-right: 12px;">
                            ${iconChar}
                        </div>
                        <div class="flex-col">
                            <span class="text-bold" style="font-size: 0.9rem; color:#333;">${item.title}</span>
                            <small class="text-light">${item.category === 'shop' ? 'ì‚¬ìš© ì™„ë£Œ' : 'ì§€ê¸‰ ì™„ë£Œ'}</small>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="${colorClass} text-bold" style="font-size: 1rem;">${amountStr}</div>
                        ${item.balance ? `<small class="text-light">ì”ì•¡ ${item.balance.toLocaleString()}</small>` : ''}
                    </div>
                </div>
            `;
                $list.append(html);
            });

            if (endIndex >= filteredData.length) {
                $btnMore.hide();
            } else {
                $btnMore.show();
                $btnMore.text(`ğŸ‘‡ ë” ë³´ê¸° (${filteredData.length - endIndex}ê°œ)`);
            }
        }


        $(function () {
            setHistoryFilter('*');
        });
    </script>
    <div style="margin: 25px 25px 10px 25px; display: flex; align-items: center;">
        <div style="width: 4px; height: 16px; background-color: #4A90E2; border-radius: 2px; margin-right: 10px;"></div>
        <h3 style="margin: 0; font-size: 1.15rem; color: #333; font-weight: 800;">í¬ì¸íŠ¸ ì ë¦½/ì‚¬ìš©</h3>
    </div>
    <div class="point-summary-card">
        <span style="font-size: 0.85rem; opacity: 0.8;">í˜„ì¬ ë³´ìœ  ë‹¬ë€íŠ¸</span>
        <h2 style="font-size: 3rem; font-weight: 800; margin: 15px 0 25px 0; letter-spacing: -1px;">
            <span class="sub-money">2,500</span> <small style="font-size: 1.2rem;">P</small>
        </h2>
        <div class="flex-row"
             style="justify-content: space-around; background: rgba(0,0,0,0.08); border-radius: 15px; padding: 12px; backdrop-filter: blur(5px);">
            <div class="flex-col flex-center text-sub" style="color: white;">
                <span>ì´ë²ˆ ì£¼ íšë“</span>
                <strong style="font-size: 1rem;">+150 P</strong>
            </div>
            <div style="width: 1px; height: 25px; background: rgba(255,255,255,0.3);"></div>
            <div class="flex-col flex-center text-sub" style="color: white;">
                <span>ì´ë²ˆ ì£¼ ì‚¬ìš©</span>
                <strong style="font-size: 1rem; color: #FFCDD2;">-500 P</strong>
            </div>
        </div>
    </div>

    <div class="flex-row gap-10" style="margin: 20px 20px 10px 20px;">
        <button class="filter-tab active" onclick="setHistoryFilter('*')">ì „ì²´</button>
        <button class="filter-tab" onclick="setHistoryFilter('+')">ì ë¦½ (+)</button>
        <button class="filter-tab" onclick="setHistoryFilter('-')">ì‚¬ìš© (-)</button>
    </div>
    <div class="menu-list" id="point-history-list" style="min-height: 200px;">
    </div>
    <button id="btn-load-more" class="btn-outline"
            style="display: block; width: 150px; margin: 20px auto 40px; padding: 10px 20px; border-radius: 50px;"
            onclick="loadMoreHistory()">ğŸ‘‡ ë” ë³´ê¸°
        (More)
    </button>
</th:block>
</html>