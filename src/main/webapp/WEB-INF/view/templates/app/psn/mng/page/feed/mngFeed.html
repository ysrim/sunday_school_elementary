<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/app/psn/mng/layouts/mng_layout}" lang="ko">
<th:block layout:fragment="content">
	<script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>

	<div id="page-notice" class="page-content w-full min-h-screen bg-[#f8fafc] p-6 lg:p-10 font-sans text-slate-600 animate-slide-up">

		<div id="view-list" class="flex flex-col h-full max-w-7xl mx-auto">

			<header class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
				<div>
					<div class="flex items-center gap-2 mb-2">
						<span class="px-2.5 py-0.5 rounded bg-indigo-50 text-indigo-600 text-[11px] font-bold uppercase tracking-wider border border-indigo-100">Community</span>
						<span class="text-xs text-slate-400 font-medium">Kingdom Notices</span>
					</div>
					<h1 class="text-3xl font-black text-slate-900 tracking-tight">ê³µì§€ì‚¬í•­ ê´€ë¦¬</h1>
					<p class="text-sm text-slate-500 mt-2 font-medium">ì™•êµ­ ë‚´ ì†Œì‹, ì´ë²¤íŠ¸, ê°€ì •í†µì‹ ë¬¸ì„ ì‘ì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
				</div>
				<button onclick="NoticeManager.ui.toggleMode('write')"
				        class="bg-indigo-600 text-white px-5 py-3 rounded-xl text-sm font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition flex items-center transform hover:-translate-y-0.5 active:translate-y-0">
					<i class="fas fa-pen mr-2"></i> ê³µì§€ì‚¬í•­ ì‘ì„±
				</button>
			</header>

			<div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-6 flex flex-wrap gap-3 justify-between items-center">
				<div class="flex gap-2 w-full md:w-auto">
					<select id="filterCategory" onchange="NoticeManager.grid.onFilterChanged()"
					        class="appearance-none bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-xs font-bold text-slate-600 outline-none cursor-pointer hover:border-indigo-300 transition focus:ring-2 focus:ring-indigo-100 min-w-[120px]">
						<option value="">ì „ì²´ ë¶„ë¥˜</option>
						<option value="NOTICE">ğŸ“¢ ê³µì§€ì‚¬í•­</option>
						<option value="EVENT">ğŸ‰ ì´ë²¤íŠ¸</option>
						<option value="NEWS">ğŸ“° ê°€ì •í†µì‹ ë¬¸</option>
					</select>
					<select class="appearance-none bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-xs font-bold text-slate-600 outline-none cursor-pointer hover:border-indigo-300 transition focus:ring-2 focus:ring-indigo-100">
						<option value="">ì „ì²´ ê¸°ê°„</option>
						<option value="1W">ìµœê·¼ 1ì£¼</option>
						<option value="1M">ìµœê·¼ 1ë‹¬</option>
					</select>
				</div>
				<div class="relative w-full md:w-80 group">
					<input type="text" id="gridSearchInput" placeholder="ì œëª© ë˜ëŠ” ì‘ì„±ì ê²€ìƒ‰..."
					       class="w-full pl-10 pr-4 py-2.5 bg-slate-50 border-none ring-1 ring-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-indigo-500 focus:bg-white transition-all placeholder:text-slate-400">
					<i class="fas fa-search absolute left-3.5 top-3 text-slate-400 group-focus-within:text-indigo-500 transition-colors"></i>
				</div>
			</div>

			<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden flex-grow relative">
				<div id="noticeGrid" class="ag-theme-quartz" style="width: 100%; height: 600px;"></div>
			</div>
		</div>

		<div id="view-write" class="hidden animate-slide-up max-w-5xl mx-auto">
			<header class="flex justify-between items-center mb-8 sticky top-0 bg-[#f8fafc]/90 backdrop-blur-sm z-10 py-4">
				<div class="flex items-center gap-4">
					<button onclick="NoticeManager.ui.toggleMode('list')"
					        class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-500 flex items-center justify-center hover:bg-slate-50 hover:text-slate-900 transition shadow-sm">
						<i class="fas fa-arrow-left"></i>
					</button>
					<div>
						<h1 id="form-title" class="text-2xl font-black text-slate-900 tracking-tight">ê³µì§€ì‚¬í•­ ì‘ì„±</h1>
						<p class="text-xs text-slate-500 font-medium mt-1">ìƒˆë¡œìš´ ì†Œì‹ì„ ì™•êµ­ êµ¬ì„±ì›ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤.</p>
					</div>
				</div>
				<div class="flex gap-2">
					<button onclick="NoticeManager.ui.toggleMode('list')"
					        class="px-5 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 text-sm font-bold hover:bg-slate-50 transition shadow-sm">
						ì·¨ì†Œ
					</button>
					<button class="px-6 py-2.5 rounded-xl bg-indigo-600 text-white text-sm font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition flex items-center">
						<i class="fas fa-paper-plane mr-2"></i> ê²Œì‹œí•˜ê¸°
					</button>
				</div>
			</header>

			<form id="noticeForm" class="pb-20">
				<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
					<div class="lg:col-span-3 space-y-6">
						<div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">
							<div class="mb-6">
								<label class="form-label">ì œëª© <span class="text-red-500">*</span></label>
								<input type="text" placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
								       class="form-input text-lg font-bold placeholder-slate-300 py-3">
							</div>

							<div>
								<label class="form-label">ë‚´ìš©</label>
								<div class="border border-slate-200 rounded-t-xl bg-slate-50 p-2 flex gap-1 border-b-0">
									<button type="button" class="p-2 text-slate-500 hover:bg-white hover:text-indigo-600 rounded transition"><i class="fas fa-bold"></i></button>
									<button type="button" class="p-2 text-slate-500 hover:bg-white hover:text-indigo-600 rounded transition"><i class="fas fa-italic"></i></button>
									<button type="button" class="p-2 text-slate-500 hover:bg-white hover:text-indigo-600 rounded transition"><i class="fas fa-underline"></i></button>
									<div class="w-px h-5 bg-slate-300 mx-2 my-auto"></div>
									<button type="button" class="p-2 text-slate-500 hover:bg-white hover:text-indigo-600 rounded transition"><i class="fas fa-align-left"></i></button>
									<button type="button" class="p-2 text-slate-500 hover:bg-white hover:text-indigo-600 rounded transition"><i class="fas fa-align-center"></i></button>
									<div class="w-px h-5 bg-slate-300 mx-2 my-auto"></div>
									<button type="button" class="p-2 text-slate-500 hover:bg-white hover:text-indigo-600 rounded transition"><i class="fas fa-image"></i></button>
								</div>
								<textarea
										class="w-full h-96 border border-slate-200 rounded-b-xl p-5 text-sm text-slate-700 outline-none resize-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-500 transition leading-relaxed"
										placeholder="ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”."></textarea>
							</div>
						</div>

						<div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
							<label class="form-label flex items-center mb-3"><i class="fas fa-paperclip mr-2"></i> ì²¨ë¶€íŒŒì¼</label>
							<div class="border-2 border-dashed border-slate-200 rounded-2xl p-10 text-center hover:bg-indigo-50/50 hover:border-indigo-300 transition cursor-pointer group">
								<div class="w-12 h-12 bg-indigo-50 text-indigo-500 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform shadow-sm">
									<i class="fas fa-cloud-upload-alt text-lg"></i>
								</div>
								<p class="text-sm font-bold text-slate-600">í´ë¦­í•˜ì—¬ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
								<p class="text-xs text-slate-400 mt-1">ë˜ëŠ” íŒŒì¼ì„ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš” (ìµœëŒ€ 10MB)</p>
							</div>
						</div>
					</div>

					<div class="lg:col-span-1 space-y-6">
						<div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm sticky top-24">
							<h2 class="text-xs font-black text-slate-800 uppercase mb-5 tracking-wider border-b border-slate-100 pb-3 flex items-center justify-between">
								ê²Œì‹œ ì„¤ì • <i class="fas fa-cog text-slate-300"></i>
							</h2>

							<div class="space-y-5">
								<div>
									<label class="form-label">ì¹´í…Œê³ ë¦¬</label>
									<select class="form-input">
										<option value="NOTICE">ğŸ“¢ ê³µì§€ì‚¬í•­</option>
										<option value="EVENT">ğŸ‰ ì´ë²¤íŠ¸</option>
										<option value="NEWS">ğŸ“° ê°€ì •í†µì‹ ë¬¸</option>
									</select>
								</div>

								<div>
									<label class="form-label">ê²Œì‹œ ì˜µì…˜</label>
									<div class="space-y-3 bg-slate-50 p-4 rounded-xl border border-slate-100">
										<label class="flex items-center gap-3 cursor-pointer group">
											<input type="checkbox" class="w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
											<span class="text-xs font-bold text-slate-600 group-hover:text-indigo-600 transition-colors">ğŸ“Œ ìƒë‹¨ ê³ ì • (Pin)</span>
										</label>
										<label class="flex items-center gap-3 cursor-pointer group">
											<input type="checkbox" class="w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
											<span class="text-xs font-bold text-slate-600 group-hover:text-indigo-600 transition-colors">ğŸ”’ ë¹„ê³µê°œ ì²˜ë¦¬</span>
										</label>
									</div>
								</div>

								<div>
									<label class="form-label">ê²Œì‹œ ê¸°ê°„</label>
									<input type="text" placeholder="ì„¤ì • ì•ˆí•¨"
									       class="form-input text-center cursor-not-allowed bg-slate-50 text-slate-400" disabled
									       value="ìƒì‹œ ê²Œì‹œ">
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>

	</div>

	<script th:inline="javascript">
		/*<![CDATA[*/

		/*<![CDATA[*/

		const NoticeManager = {
			gridApi: null,

			init() {
				this.grid.init();
				this.bindEvents();
				this.grid.loadData();
			},

			grid: {
				init() {
					const columnDefs = [
						{
							headerName: "No", field: "id", width: 80,
							cellClass: "flex items-center justify-center font-mono text-slate-400 text-xs",
						},
						{
							headerName: "ë¶„ë¥˜", field: "category", width: 120,
							cellClass: "flex items-center justify-center",
							cellRenderer: (params) => {
								let badgeClass = "bg-slate-100 text-slate-500 border-slate-200";
								let label = "ì¼ë°˜";

								if (params.value === 'NOTICE') {
									badgeClass = "bg-red-50 text-red-600 border-red-100";
									label = "ğŸ“¢ ê³µì§€";
								} else if (params.value === 'EVENT') {
									badgeClass = "bg-indigo-50 text-indigo-600 border-indigo-100";
									label = "ğŸ‰ ì´ë²¤íŠ¸";
								} else if (params.value === 'NEWS') {
									badgeClass = "bg-green-50 text-green-600 border-green-100";
									label = "ğŸ“° í†µì‹ ë¬¸";
								}

								return `<span class="px-2.5 py-1 rounded-lg text-[11px] font-bold border ${badgeClass}">${label}</span>`;
							}
						},
						{
							headerName: "ì œëª©", field: "title", flex: 1, minWidth: 300,
							cellClass: "flex items-center",
							cellRenderer: (params) => {
								const pinIcon = params.data.isPinned
									? `<i class="fas fa-thumbtack text-red-400 mr-2 text-xs transform rotate-45"></i>`
									: ``;
								const titleClass = params.data.isPinned ? "text-slate-900 font-black" : "text-slate-700 font-bold";

								return `
                            <div class="flex items-center w-full cursor-pointer group">
                                ${pinIcon}
                                <span class="${titleClass} group-hover:text-indigo-600 transition-colors text-sm truncate">${params.value}</span>
                                ${params.data.isNew ? '<span class="ml-2 w-1.5 h-1.5 bg-red-500 rounded-full"></span>' : ''}
                            </div>
                        `;
							}
						},
						{
							headerName: "ì‘ì„±ì", field: "writer", width: 120,
							cellClass: "flex items-center justify-center font-medium text-slate-600 text-xs",
						},
						{
							headerName: "ì‘ì„±ì¼", field: "regDate", width: 120,
							cellClass: "flex items-center justify-center font-mono text-slate-500 text-xs",
						},
						{
							headerName: "ì¡°íšŒ", field: "viewCount", width: 100,
							cellClass: "flex items-center justify-center text-slate-400 text-xs font-mono",
							valueFormatter: (params) => params.value.toLocaleString()
						},
						{
							headerName: "ê´€ë¦¬", width: 100,
							cellClass: "flex items-center justify-center",
							cellRenderer: (params) => {
								return `
                            <button class="w-8 h-8 rounded-lg hover:bg-indigo-50 text-slate-400 hover:text-indigo-600 transition flex items-center justify-center" onclick="NoticeManager.ui.edit(${params.data.id})">
                                <i class="fas fa-edit text-xs"></i>
                            </button>
                        `;
							}
						}
					];

					const gridOptions = {
						columnDefs: columnDefs,
						rowData: [],
						defaultColDef: {resizable: true, sortable: true},

						// [ìˆ˜ì •] í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì • ê°•í™”
						pagination: true,
						paginationPageSize: 10, // ê¸°ë³¸ í˜ì´ì§€ í¬ê¸° (10ê°œì”© ë³´ê¸°)
						paginationPageSizeSelector: [10, 20, 50, 100], // ì‚¬ìš©ìê°€ ì„ íƒ ê°€ëŠ¥í•œ ì˜µì…˜

						rowHeight: 60,
						headerHeight: 48,
						rowClass: "hover:bg-slate-50 transition-colors border-b border-slate-50 last:border-none",
						onRowClicked: (event) => {
							// Row í´ë¦­ ì´ë²¤íŠ¸
						}
					};

					const gridDiv = document.querySelector('#noticeGrid');
					NoticeManager.gridApi = agGrid.createGrid(gridDiv, gridOptions);
				},

				loadData() {
					const api = NoticeManager.gridApi;
					if (!api) return;

					// [ìˆ˜ì •] í˜ì´ì§• í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë”ë¯¸ ë°ì´í„° 50ê°œ ìƒì„±
					const dummyData = [];
					const categories = ['NOTICE', 'EVENT', 'NEWS'];
					const writers = ['ê´€ë¦¬ì', 'ê¹€ì„ ìƒ', 'ë°•ì„ ìƒ', 'ì´ì´ë¬´'];

					for (let i = 1; i <= 55; i++) {
						const isPinned = i <= 3; // ìƒìœ„ 3ê°œ ê³ ì •
						const randomCat = categories[Math.floor(Math.random() * categories.length)];

						dummyData.push({
							id: 1000 - i,
							category: isPinned ? 'NOTICE' : randomCat,
							title: isPinned ? `[í•„ë…] ì¤‘ìš” ê³µì§€ì‚¬í•­ í…ŒìŠ¤íŠ¸ ì œëª© ${i}` : `ì™•êµ­ ì†Œì‹ ë° ì´ë²¤íŠ¸ ì•ˆë‚´ ê²Œì‹œê¸€ ${i}`,
							writer: writers[i % writers.length],
							regDate: `2026.02.${String((i % 28) + 1).padStart(2, '0')}`,
							viewCount: Math.floor(Math.random() * 2000),
							isPinned: isPinned,
							isNew: i < 10
						});
					}

					api.updateGridOptions({rowData: dummyData});
				},

				onFilterChanged() {
					const category = document.getElementById('filterCategory').value;
					const api = NoticeManager.gridApi;

					if (category) {
						// ê°„ë‹¨ í•„í„°ë§ ì˜ˆì‹œ
						api.setGridOption('quickFilterText', category === 'NOTICE' ? 'ê³µì§€' : (category === 'EVENT' ? 'ì´ë²¤íŠ¸' : 'í†µì‹ ë¬¸'));
					} else {
						api.setGridOption('quickFilterText', '');
					}
				}
			},

			bindEvents() {
				$('#gridSearchInput').on('input', function () {
					if (NoticeManager.gridApi) NoticeManager.gridApi.setGridOption('quickFilterText', $(this).val());
				});
			},

			ui: {
				toggleMode(mode) {
					const listDiv = $('#view-list');
					const writeDiv = $('#view-write');
					const title = $('#form-title');

					if (mode === 'write') {
						$('#noticeForm')[0].reset();
						title.text('ê³µì§€ì‚¬í•­ ì‘ì„±');
						listDiv.addClass('hidden');
						writeDiv.removeClass('hidden');
						window.scrollTo(0, 0);
					} else if (mode === 'list') {
						writeDiv.addClass('hidden');
						listDiv.removeClass('hidden');
						if (NoticeManager.gridApi) NoticeManager.gridApi.sizeColumnsToFit();
					}
				},

				edit(id) {
					this.toggleMode('write');
					$('#form-title').text('ê³µì§€ì‚¬í•­ ìˆ˜ì •');
				}
			}
		};

		$(function () {
			NoticeManager.init();
		});
		/*]]>*/
	</script>
</th:block>
</html>