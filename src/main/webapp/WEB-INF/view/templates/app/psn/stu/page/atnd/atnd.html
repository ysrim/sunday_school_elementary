<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/app/psn/stu/layouts/std_layout}">

<th:block layout:fragment="content">
	<script th:inline="javascript">
		$(function () {
			const options = {month: 'long', day: 'numeric', weekday: 'long'};

			if ($('#stamp-zone').hasClass('checked')) {
				_showAlert('μ΄λ―Έ μ¤λμ μ¶μ„μ„ μ™„λ£ν–μµλ‹λ‹¤!', 'π“…', 'μ•λ¦Ό');
				$('#stamp-zone').css({
					'background': '#FFF0F0',
					'border-color': '#FF6B6B'
				}).html('<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" style="width:110px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));">');
			}

			$('#stamp-zone').click(function () {
				if (!$(this).hasClass('sunday')) {
					_showAlert('μ¶μ„μ€ μ£ΌμΌμ—λ§ κ°€λ¥ν•©λ‹λ‹¤!', 'π“…', 'μ•λ¦Ό');
					return;
				}
				if ($(this).hasClass('checked')) {
					_showAlert('μ΄λ―Έ μ¤λμ μ¶μ„μ„ μ™„λ£ν–μµλ‹λ‹¤!', 'π“…', 'μ•λ¦Ό');
					$(this).css({
						'background': '#FFF0F0',
						'border-color': '#FF6B6B'
					}).html('<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" style="width:110px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));">');
					return;
				}
				$.ajax({
					type: "POST",
					url: "/std/atnd.ax",
					success: (data) => {
						if (data.rtnCd === '001') {
							// λ„μ¥ μ°κΈ° μ—°μ¶
							$(this).addClass('checked').css({
								'background': '#FFF0F0',
								'border-color': '#FF6B6B'
							}).html('<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" style="width:110px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));">');

							$('.slot-circle.today').addClass('checked');

							_showAlert('μ°Έ μν–μ–΄μ”!<br>μ¶μ„ λ‹¬λ€νΈ <b>+100P</b>λ¥Ό νλ“ν–μµλ‹λ‹¤!',
								'<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" style="width:80px;">', 'μ¶μ„ μ„±κ³µ!');
						} else {
							_showAlert('μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤!', 'π”¥', 'μ¤λ¥');
						}
					},
					error: (e) => {
						_showAlert('ν†µμ‹  μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.', 'π”¥', 'μ¤λ¥');
					}
				});
			});
		});
	</script>

	<div style="margin: 25px 25px 10px 25px; display: flex; align-items: center;">
		<div style="width: 4px; height: 16px; background-color: #4A90E2; border-radius: 2px; margin-right: 10px;"></div>
		<h3 style="margin: 0; font-size: 1.15rem; color: #333; font-weight: 800;">λ‚μ μ¶μ„ ν„ν™©</h3>
	</div>

	<div class="card" style="margin: 0 15px; padding: 35px 20px; text-align: center; border-radius: 30px; box-shadow: 0 12px 30px rgba(0,0,0,0.06); border: none; background: #fff;">

		<div style="margin-bottom: 25px;">
			<h3 style="color: #333; font-size: 1.4rem; font-weight: 800; margin: 0;">π“… [[${currMonth}]]μ›” μ¶μ„λ¶€</h3>
			<div style="display: inline-block; padding: 4px 12px; background: #f0f7ff; color: #4A90E2; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-top: 8px;">
				μ£ΌμΌμ£ΌμΌ μ±λ¦°μ§€!
			</div>
		</div>

		<div style="background: #fdfdfd; border-radius: 20px; padding: 20px 10px; border: 1px solid #f0f0f0;">
			<h4 style="color: #666; margin-bottom: 5px; font-weight: 700; font-size: 0.95rem;">μ¤λμ μ¶μ„ λ„μ¥</h4>
			<div id="stamp-zone" th:class="|${isAttendance ? 'sunday' : ''} ${attendanceToday == 'Y' ? ' checked' : ''}|">
				<img src="https://cdn-icons-png.flaticon.com/512/839/839374.png" style="width:50px; opacity: 0.3; margin-bottom: 5px;">
				<span style="font-size:0.9rem; color:#999; font-weight: 700; line-height:1.4;">ν„°μΉν•΄μ„<br>λ„μ¥ μ°κΈ°!</span>
			</div>
		</div>

		<div class="attendance-status-board" style="display: flex; justify-content: space-between; max-width: 280px; margin: 30px auto 10px auto;">
			<div class="day-slot" th:each="vo : ${attendanceList}" style="text-align: center;">
				<div th:class="|slot-circle ${vo.attendance} ${vo.today}|"
					 style="width: 38px; height: 38px; border-radius: 12px; background: #f0f0f0; margin-bottom: 8px; transition: all 0.3s;"></div>
				<span style="font-size: 0.75rem; color: #bbb; font-weight: 600;">[[${vo.week}]]μ£Ό</span>
			</div>
		</div>

		<p style="font-size: 0.85rem; color: #777; margin-top: 20px;">
			μ£ΌμΌμ— μ¶μ„ν•κ³  μ„ μƒλ‹μ΄ ν™•μΈν•λ©΄<br> <b style="color: #FF6B6B;">1 λ‹¬λ€νΈ</b>κ°€ ν‘! π
		</p>
	</div>
</th:block>
</html>