<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/app/psn/stu/layouts/std_layout}">
<th:block layout:fragment="content">
	<script th:inline="javascript">
		function handleQuest(btn) {
			$(btn).text("처리중...");
			$(btn).addClass("disabled").prop("disabled", true);
			$.ajax({
				type: "POST",
				url: "/std/qest/qest.ax",
				data: {questSn: btn.dataset.sn},
				success: (data) => {
					if (data.rtnCd === '001') {
						$(btn).text("승인요청");
						$(btn).closest('.quest-row').addClass('done');
						_showAlert('선생님께 확인 요청을 보냈어요. 조금만 기다려주세요!', '✨', '퀘스트 확인 요청');
					} else {
						_showAlert('오류가 발생했습니다!', '🔥', '오류');
					}
				},
				error: (e) => {
					_showAlert('통신 오류가 발생했습니다.', '🔥', '오류');
				}
			});
		}
	</script>
	<div style="margin: 25px 25px 15px 25px; display: flex; align-items: center;">
		<span style="color: #4A90E2; font-size: 0.8rem; margin-right: 8px;">●</span>
		<h3 style="margin: 0; font-size: 1.1rem; color: #333;">일일 퀘스트</h3>
	</div>

	<div class="card quest-container">
		<div th:class="|quest-row${vo.status != null ? ' done': ''}|" th:each="vo : ${questList}" th:if="${vo.questType == 'DAILY'}">
			<div class="quest-info" style="display: flex; align-items: center;">
				<span class="quest-icon" style="font-size: 1.5rem; margin-right: 12px;" th:text="|${vo.emoji}|">🙏</span>
				<div class="quest-text" style="display: flex; flex-direction: column;">
					<span class="quest-title" style="font-weight: bold; color: #333;" th:text="|${vo.title} (${vo.description})|">아침 기도하기</span>
					<span class="quest-reward" style="font-size: 0.75rem; color: #888;" th:text="|${vo.rewardExp} EXP / ${vo.rewardPoint} P|">10 EXP / 50 P</span>
				</div>
			</div>
			<button class="btn-quest-action" th:data-sn="${vo.questSn}" th:disabled="${vo.status == 'PENDING' or vo.status == 'APPROVED' or vo.status == 'REJECTED'}" onclick="handleQuest(this)"
					th:text="${vo.statusNm == null ? '완료하기' : vo.statusNm}">
			</button>
		</div>
	</div>
	<div th:if="${isAttendance}">
		<!-- 주일만 가능 -->
		<div style="margin: 25px 25px 15px 25px; display: flex; align-items: center;">
			<span style="color: #4A90E2; font-size: 0.8rem; margin-right: 8px;">●</span>
			<h3 style="margin: 0; font-size: 1.1rem; color: #333;">주일 퀘스트</h3>
		</div>
		<div class="card quest-container">
			<div th:class="|quest-row${vo.status != null ? ' done': ''}|" th:each="vo : ${questList}" th:if="${vo.questType == 'WEEKLY'}">
				<div class="quest-info" style="display: flex; align-items: center;">
					<span class="quest-icon" style="font-size: 1.5rem; margin-right: 12px;" th:text="|${vo.emoji}|">🙏</span>
					<div class="quest-text" style="display: flex; flex-direction: column;">
						<span class="quest-title" style="font-weight: bold; color: #333;" th:text="|${vo.title} (${vo.description})|">아침 기도하기</span>
						<span class="quest-reward" style="font-size: 0.75rem; color: #888;" th:text="|${vo.rewardExp} EXP / ${vo.rewardPoint} P|">10 EXP / 50 P</span>
					</div>
				</div>
				<button class="btn-quest-action" th:data-sn="${vo.questSn}" th:disabled="${vo.status == 'PENDING' or vo.status == 'APPROVED' or vo.status == 'REJECTED'}" onclick="handleQuest(this)"
						th:text="${vo.statusNm == null ? '완료하기' : vo.statusNm}">
				</button>
			</div>
		</div>
	</div>
</th:block>
</html>