<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/app/psn/std/layouts/std_layout}" lang="ko">
<th:block layout:fragment="content">
	<script th:inline="javascript">
        $(function () {
            $('#stamp-zone').click(function () {
                if (!(new Date().getDay() === 0)) {
                    _showAlert('출석은 주일만 가능!', '📅', '알림');
                    return;
                }
                $.ajax({
                    type: "POST",
                    url: "/std/atnd.ax",
                    success: (data) => {
                        if (data.rtnCd === '001') {
                            $(this).addClass('checked').css({
                                'background': '#FFF0F0',
                                'border-color': '#FF6B6B'
                            }).html('<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" alt="출석" style="width:110px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));">');
                            $('.slot-circle.today').addClass('checked');
                            _showAlert('선생님께 출석 체크 요청!', '<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" alt="출석" style="width:80px;">', '출석 요청!');
                        } else {
                            _showAlert('오류가 발생했습니다!', '🔥', '오류');
                        }
                    },
                    error: (e) => {
                        _showAlert('통신 오류가 발생했습니다.', '🔥', e);
                    }
                });
            });
        });
	</script>
	<div style="margin: 25px 25px 10px 25px; display: flex; align-items: center;">
		<div style="width: 4px; height: 16px; background-color: #4A90E2; border-radius: 2px; margin-right: 10px;"></div>
		<h3 style="margin: 0; font-size: 1.15rem; color: #333; font-weight: 800;">나의 출석 현황</h3>
	</div>
	<th:block th:if="${attenanceCount > 1}">
		<div class="card attendance-card">
			<div class="flex-between">
				<div class="flex-row gap-10">
					<span style="font-size: 1.5rem;">🔥</span>
					<span>현재 <b th:text="|${attenanceCount}주 연속|">3주 연속</b> 개근 중!</span>
				</div>
				<div style="background: rgba(255,255,255,0.25); padding: 6px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8rem;">
					출석왕 도전!
				</div>
			</div>
		</div>
	</th:block>
	<div class="card text-center" style="padding: 30px 20px;">
		<div class="flex-center gap-10 mb-10">
			<h3 id="attendance-date-title">2월 출석부</h3>
			<span class="text-white" id="sunday-badge"
			      style="display:none; background: var(--secondary); font-size: 0.7rem; padding: 3px 8px; border-radius: 4px;">오늘은 주일!</span>
		</div>
		<p style="background: #F8F9FA; padding: 6px 12px; border-radius: 8px; display: inline-block; margin-bottom: 25px; color: #666; font-size: 0.9rem;">
			🎁 주일 예배 출석 보상: <b class="text-red">5달란트</b> 와 <b class="text-blue">10EXP</b>
		</p>
		<div id="stamp-zone" class="stamp-btn"
		     style="background: radial-gradient(circle, #FFF9C4 0%, #ffffff 70%); border: 2px dashed #E0E0E0; position: relative; overflow: hidden;">

			<div class="stamp-inner-content flex-col flex-center" style="z-index: 2;">
				<img src="https://cdn-icons-png.flaticon.com/512/2693/2693507.png" class="stamp-icon-before" alt="교회"
				     style="width: 48px; margin-bottom: 8px; opacity: 0.8;">
				<span class="stamp-guide-text" id="stamp-guide-msg"
				      style="color: var(--secondary); font-weight: 800; font-size: 0.85rem; line-height: 1.3;">주일(일요일)에<br>만나요!</span>
			</div>

			<div class="stamped-mark" style="display:none;">
				<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" alt="참잘했어요"
				     style="width: 130px;">
			</div>
		</div>
		<p class="text-light mt-15">* 매주 일요일, 교회에 와서 도장을 꾹! 눌러주세요.</p>
	</div>
	<div class="section-title">📅 2월의 주일(Sunday)</div>
	<div id="sunday-list-container" class="flex-col gap-10" style="padding: 0 20px 30px 20px;">
		<div class="menu-item sunday-item"
		     style="border: 1px solid #f0f0f0; border-radius:12px; padding:15px; cursor:default;"
		     th:each="vo : ${attendanceList}">
			<div class="flex-row gap-15">
				<div class="flex-col text-center" style="min-width:40px;">
					<span class="text-light" th:text="|${#temporals.month(#temporals.createNow())}월|">2월</span>
					<span class="text-bold" style="font-size:1.1rem; color:#444;" th:text="|${vo.day}|">1</span>
				</div>
				<div class="text-bold text-sub">주일 예배</div>
			</div>
			<div th:switch="${vo.status}">
				<!-- <span th:text="${#calendars.format(#calendars.createNow(), 'yyyyMMdd')}"></span> -->
				<span class="text-bold text-sub" th:case="APPROVED">✅ 출석완료!</span>
				<span class="text-bold text-sub" th:case="PENDING">⏳ 선생님 확인중!</span>
				<span class="text-bold text-sub" th:case="REJECTED">⚠️ 반려!</span>
				<span class="text-bold text-sub" th:case="*">🙏 주일 꼭! 성수해요</span>
			</div>
		</div>
	</div>
</th:block>
</html>