<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/app/psn/stu/layouts/std_layout}" lang="ko">
<th:block layout:fragment="content">
	<script th:inline="javascript">
		const StdHomeUI = {
			init: function () {
				this.cacheDOM();
				this.render();
			},
			cacheDOM: function () {
				this.$expBar = $('#exp-bar');
				this.$expText = $('#current-exp');
				this.$typingTarget = $('#typing-bible');
			},
			render: function () {
				this.animateExpBar(); // 1. ì´ˆê¸° ê²½í—˜ì¹˜ ë°” ì• ë‹ˆë©”ì´ì…˜
				const text = this.$typingTarget.html(); // HTML data-text ì†ì„±ì—ì„œ ê°€ì ¸ì˜´
				this.typeWriter(this.$typingTarget, text); // 2. ë§ì”€ íƒ€ì´í•‘ íš¨ê³¼ ì‹œì‘
			},
			/**
			 * ê²½í—˜ì¹˜ ë°” ì• ë‹ˆë©”ì´ì…˜
			 * data-current, data-max ì†ì„±ì„ í™œìš©í•˜ì—¬ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬
			 */
			animateExpBar: function () {
				// HTML íƒœê·¸ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸° (ì˜ˆ: <span id="current-exp" data-current="60" data-max="100">)
				const current = this.$expText.data('current') || 0;
				const max = this.$expText.data('max') || 100;
				const percentage = Math.min((current / max) * 100, 100); // 100% ë„˜ì§€ ì•Šë„ë¡ ë°©ì§€
				// CSS ì´ˆê¸°í™” í›„ ì• ë‹ˆë©”ì´ì…˜
				this.$expBar.css('width', '0%');
				setTimeout(() => {
					this.$expBar.css({
						'width': percentage + '%',
						'transition': 'width 1s ease-out' // CSS transition í™œìš© (ë” ë¶€ë“œëŸ¬ì›€)
					});
				}, 100);
			},
			/**
			 * íƒ€ì´í•‘ íš¨ê³¼ (ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜)
			 * @param {jQuery} $element - ëŒ€ìƒ ìš”ì†Œ
			 * @param {String} text - íƒ€ì´í•‘í•  í…ìŠ¤íŠ¸
			 * @param {Number} speed - ì†ë„ (ms)
			 */
			typeWriter: function ($element, text, speed = 100) {
				if (!text) return;
				$element.text(''); // ì´ˆê¸°í™”
				let i = 0;

				function typing() {
					if (i < text.length) {
						$element.text(text.substring(0, i + 1));
						i++;
						setTimeout(typing, speed);
					}
				}

				typing();
			}
		};

		$(function () {
			$('#btn-amen').one("click", function () {
				$.ajax({
					type: 'GET', url: '/std/home/wordsAmen.ax', success: (data) => {
						$('#btn-amen').addClass('disabled').text('ì˜¤ëŠ˜ì˜ ë§ì”€ì„ ë§ˆìŒì— ìƒˆê²¼ìŠµë‹ˆë‹¤ âœ¨');
						_showAlert('ì˜¤ëŠ˜ë„ í•˜ë£¨ë„ ë§ì”€ìœ¼ë¡œ ìŠ¹ë¦¬í•´ìš”!', 'âœ¨', 'ì•„ë©˜!');
					}, error: (e) => {
						console.error(e);
					}
				});
			});
			StdHomeUI.init();
			/*[# th:each="msg, stat : ${toastMsgList}"]*/
			_showToast('[(${msg.toastSn})]', '[(${msg.title})]', '[(${msg.message})]', '[(${msg.toastType})]');
			/*[/]*/ // ë°˜ë³µë¬¸ ì¢…ë£Œ
		});
	</script>
	<div class="profile-card">
		<div class="flex-row mb-20">
			<div class="profile-avatar-frame">
				<img th:src="|https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/avatar/${session.mberInfo.occpCode}_${#strings.toLowerCase(session.mberInfo.sexdstn)}.png|" alt="ë‚´ ìºë¦­í„°"
					 style="width:100%; height:100%; object-fit:cover; border-radius:18px;">
			</div>
			<div style="margin-left: 15px;">
				<div class="flex-row gap-5">
					<span class="rank-badge" style="background: #E3F2FD; color: #4A90E2;" th:text="|${guildInfo.guildNm} ê¸¸ë“œ|"></span>
					<span class="rank-badge" style="background: #FFF3E0; color: #EF6C00;"><span id="" th:text="|${_mberPoint}|">2,500</span> ë‹¬ë€íŠ¸</span>
				</div>
				<h2 class="mt-5" style="font-size: 1.3rem;" th:text="|Lv.${_mberLevel} ${session.mberInfo.ncnm}|"></h2>
			</div>
		</div>
		<div style="background: #FAFBFC; padding: 12px; border-radius: 15px;">
			<div class="flex-between text-bold text-light" style="font-size: 0.75rem;">
				<span>ì„±ì¥ ê²½í—˜ì¹˜ (EXP)</span>
				<span id="current-exp" th:text="|${_mberExp.currentExp} / ${_mberExp.levelUpRequiredExp}|" th:data-current="${_mberExp.currentExp}" th:data-max="${_mberExp.levelUpRequiredExp}"></span>
			</div>
			<div class="exp-container">
				<div id="exp-bar" class="exp-bar-fill" th:style="|width: ${_mberExp.progressPercent}%;|"></div>
			</div>
		</div>
	</div>
	<div class="card text-center">
		<div class="flex-between mb-10">
			<h4 style="margin:0;">ì˜¤ëŠ˜ì˜ ë§ì”€ ğŸ“–</h4>
			<span class="text-light">ë§¤ì¼ 1íšŒ</span>
		</div>
		<p style="font-style:italic; min-height: 1.6em; margin-bottom: 5px; text-align: left;">
			<span th:text="|${todayBibleVerse.opinion}|"></span>
		</p>
		<p style="font-style:italic; min-height: 1.6em; margin-bottom: 15px; text-align: left;">
			<span id="typing-bible" th:text="|${todayBibleVerse.words} [${todayBibleVerse.bookName} ${todayBibleVerse.chapter}ì¥ ${todayBibleVerse.verseStart}ì ˆ]|"></span>
		</p>
		<button id="btn-amen" th:class="|btn-amen ${qestCmpleteYn == 'Y' ? 'disabled' : ''}|" th:text="${qestCmpleteYn == 'Y' ? 'ì˜¤ëŠ˜ì˜ ë§ì”€ì„ ë§ˆìŒì— ìƒˆê²¼ìŠµë‹ˆë‹¤ âœ¨' : 'ğŸ™ ì•„ë©˜! (EXP +5)'}"
				th:disabled="${qestCmpleteYn == 'Y'}">
			ğŸ™ ì•„ë©˜! (EXP +5)
		</button>
	</div>
	<div class="card" style="margin-top:15px;">
		<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
			<h4 style="margin: 0;">ê³µì§€ì‚¬í•­ ğŸ“¢</h4>
		</div>
		<div class="notice-list">
			<div class="notice-item" th:onclick="|location.href='@{/std/home/noticeCont.pg}'|" style="padding: 12px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer;">
				<div style="display: flex; gap: 8px; align-items: center; margin-bottom: 4px;">
					<span style="background: #FFEBEB; color: #FF4D4D; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: bold;">ì¤‘ìš”</span>
					<span style="font-size: 0.9rem; font-weight: 700; color: #333;">ì´ë²ˆ ì£¼ ì£¼ì¼ ì•¼ì™¸ í™œë™ ì•ˆë‚´</span>
				</div>
				<p style="font-size: 0.8rem; color: #777; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">êµíšŒ ê·¼ì²˜ ê³µì›ì—ì„œ ë³´ë¬¼ì°¾ê¸°ê°€ ì§„í–‰ë©ë‹ˆë‹¤!</p>
			</div>
			<div class="notice-item" th:onclick="|location.href='@{/std/home/noticeCont.pg}'|" style="padding: 12px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer;">
				<div style="display: flex; gap: 8px; align-items: center; margin-bottom: 4px;">
					<span style="background: #E3F2FD; color: #2196F3; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: bold;">ì•ˆë‚´</span>
					<span style="font-size: 0.9rem; font-weight: 700; color: #333;">ìƒˆ ì¹œêµ¬ í™˜ì˜ íŒŒí‹° (ë‹¤ìŒ ì£¼)</span>
				</div>
				<p style="font-size: 0.8rem; color: #777; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">ìƒˆë¡œ ì˜¨ ì¹œêµ¬ë“¤ì„ ìœ„í•´ ë§›ìˆëŠ” ê°„ì‹ì´ ì¤€ë¹„ë˜ì–´ ìˆì–´ìš”.</p>
			</div>
			<div class="notice-item" th:onclick="|location.href='@{/std/home/noticeCont.pg}'|" style="padding: 12px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer;">
				<div style="display: flex; gap: 8px; align-items: center; margin-bottom: 4px;">
					<span style="background: #F5F5F5; color: #666; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: bold;">í•„ë…</span>
					<span style="font-size: 0.9rem; font-weight: 700; color: #333;">ë‹¬ë€íŠ¸ ì‹œì¥ ê°œìµœ ê³µì§€</span>
				</div>
				<p style="font-size: 0.8rem; color: #777; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">ì—´ì‹¬íˆ ëª¨ì€ ë‹¬ë€íŠ¸ë¥¼ ì‚¬ìš©í•  ì‹œê°„ì´ ì™”ìŠµë‹ˆë‹¤!</p>
			</div>
		</div>
	</div>
	<div class="card" style="padding: 20px;">
		<div style="display: flex; align-items: center; margin-bottom: 15px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 15px; border-radius: 16px; box-shadow: 0 4px 15px rgba(30, 60, 114, 0.2);">

			<div style="position: relative; width: 56px; height: 56px; margin-right: 15px; flex-shrink: 0;">
				<div style="width: 100%; height: 100%; border-radius: 14px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 4px; display: flex; align-items: center; justify-content: center;">
					<img th:src="|https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/guild/grade/guid_image_${guildInfo.grade}_${guildInfo.cla}.png|"
						 alt="ê¸¸ë“œë§ˆí¬" style="width: 90%; height: 90%; object-fit: contain;">
				</div>
				<div style="position: absolute; bottom: -5px; right: -5px; background: #FFD700; color: #333; font-size: 0.6rem; font-weight: 800; padding: 2px 6px; border-radius: 8px; border: 2px solid #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.2);"
					 th:text="|Lv.${guildInfo.guildLevel}|">
					Lv.5
				</div>
			</div>

			<div style="flex: 1; overflow: hidden;">
				<h4 style="margin: 0 0 4px 0; font-size: 1.1rem; color: #ffffff; font-weight: 800; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-shadow: 0 1px 2px rgba(0,0,0,0.2);"
					th:text="|${guildInfo.guildNm}|">ë‹¤ìœ—ì˜ ìš©ì‚¬ë“¤</h4>
				<div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.8); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
					 th:text="|â ${guildInfo.rm} â|">"ë¯¿ìŒìœ¼ë¡œ ìŠ¹ë¦¬í•˜ì!"</div>
			</div>

			<button onclick="location.href='/std/gild.pg'" style="background: none; border: none; padding: 5px; cursor: pointer;">
				<span style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.6);">â€º</span>
			</button>
		</div>

		<div>
			<div class="flex-between text-sub text-bold mb-10" style="font-size: 0.8rem; padding: 0 5px;">
				<span>ì ‘ì† ì¤‘ì¸ ë™ë£Œ</span>
				<span class="text-blue" th:text="|${guildMberAccessList.size()} / ${guildMberCnt}ëª…|">2/15ëª…</span>
			</div>

			<div th:if="${#lists.isEmpty(guildMberAccessList)}" class="text-center text-light" style="padding: 20px 0; font-size: 0.85rem;">
				ì§€ê¸ˆì€ ì ‘ì† ì¤‘ì¸ ë™ë£Œê°€ ì—†ì–´ìš” ğŸ˜´
			</div>

			<div style="display: flex; flex-direction: column; gap: 8px;">
				<div th:each="vo : ${guildMberAccessList}"
					 th:style="|display: flex; align-items: center; padding: 8px 10px; border-radius: 10px; ${vo.mberId == session.mberInfo.mberId ? 'background: #F0F7FF; border: 1px solid #D1E3FF;' : 'background: #FAFAFA;'}|">

					<img th:src="|https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/avatar/${vo.occpCode}_${#strings.toLowerCase(vo.sexdstn)}.png|"
						 alt="ì•„ë°”íƒ€" style="width: 32px; height: 32px; margin-right: 10px;">

					<div style="flex: 1;">
						<div style="font-size: 0.9rem; font-weight: 700; color: #444;">
							<span th:text="${vo.ncnm}">ë‹‰ë„¤ì„</span>
							<span th:if="${vo.mberId == session.mberInfo.mberId}" style="font-size: 0.7rem; color: #2196F3; margin-left: 4px;">(ë‚˜)</span>
						</div>
					</div>

					<div style="font-size: 0.8rem; font-weight: 700; color: #2196F3;" th:text="|Lv.${vo.level}|">Lv.15</div>
				</div>
			</div>

			<button class="btn" style="width: 100%; margin-top: 15px; background: #fff; border: 1px solid #ddd; color: #555; font-size: 0.9rem; padding: 10px; border-radius: 8px; transition: 0.2s;"
					th:onclick="|location.href='@{/std/gild.pg}'|">
				ê¸¸ë“œ ë³¸ë¶€ ì…ì¥í•˜ê¸°
			</button>
		</div>
	</div>
</th:block>
</html>