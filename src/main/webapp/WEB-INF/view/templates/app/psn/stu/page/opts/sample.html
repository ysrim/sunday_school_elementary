<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/app/psn/stu/layouts/std_layout}">
<th:block layout:fragment="content">
	<div style="margin: 25px 25px 5px 25px; display: flex; align-items: center;">
		<span style="color: #4A90E2; font-size: 0.8rem; margin-right: 8px;">â—</span>
		<h3 style="margin: 0; font-size: 1.1rem; color: #333; text-align: left;">ë§ˆì´ í˜ì´ì§€</h3>
	</div>
	<div class="profile-card" style="margin-top:0;">
		<div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
			<div class="profile-avatar-wrap" style="width: 100px; height: 100px; margin-bottom: 15px;">
				<img th:src="|https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/avatar/${session.mberInfo.occpCode}_${#strings.toLowerCase(session.mberInfo.sexdstn)}.png|" alt="ë‚´ ìºë¦­í„°"
					 style="width:100%; height:100%; object-fit:cover; border-radius:22px;">
			</div>
			<h2 id="mypage-name" th:text="|Lv.${_mberLevel} ${session.mberInfo.ncnm}(${session.mberInfo.mberNm})|"></h2>
			<p style="color: #888; font-size: 0.9rem;" th:text="|ë´‰ë™ì¤‘ì•™êµíšŒ ì´ˆë“±ë¶€ ${session.mberInfo.grade}í•™ë…„ ${session.mberInfo.cla}ë°˜|">ë´‰ë™ì¤‘ì•™êµíšŒ ì´ˆë“±ë¶€ 1í•™ë…„ 1ë°˜</p>
		</div>
	</div>

	<div class="menu-list">
		<div class="menu-item" onclick="showPage('page-qrcode')">
			<span>ğŸ” ë‚˜ì˜ QRì½”ë“œ í™•ì¸</span>
			<span class="arrow">></span>
		</div>
		<div class="menu-item">
			<span>ğŸ›¡ï¸ ìºë¦­í„° ë³€ê²½</span>
			<span class="arrow">></span>
		</div>
		<div class="menu-item" onclick="showPage('page-password-change')">
			<span>ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</span>
			<span class="arrow">></span>
		</div>
		<div class="menu-item" onclick="showPage('page-point-history')">
			<span>âœ¨ í¬ì¸íŠ¸ ë‚´ì—­</span>
			<span class="arrow">></span>
		</div>
		<div class="menu-item" style="color: #e74c3c;">
			<span>ğŸšª ë¡œê·¸ì•„ì›ƒ</span>
			<span class="arrow">></span>
		</div>
	</div>
	<script>
		let currentTalent = 2500;

		// í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
		function showPage(pageId) {
			$('.page').hide();
			$('#' + pageId).show();
			$('#bottom-nav').css('display', 'flex');


			// --- ê²½í—˜ì¹˜ ë°” ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ì¶”ê°€ ---
			if (pageId === 'page-main') {

			}
			// ------------------------------------

			$('.nav-item').removeClass('active');
			if (pageId === 'page-main') $('.nav-item').eq(0).addClass('active');
			if (pageId === 'page-attendance') $('.nav-item').eq(1).addClass('active');
			if (pageId === 'page-guild') $('.nav-item').eq(2).addClass('active');
			if (pageId === 'page-quest') $('.nav-item').eq(3).addClass('active');
			// ì¶”ê°€: ë§ˆì´í˜ì´ì§€(ì„¤ì •)ê°€ ì¼œì¡Œì„ ë•Œ 4ë²ˆ ì¸ë±ìŠ¤(5ë²ˆì§¸) ë²„íŠ¼ í™œì„±í™”
			if (pageId === 'page-mypage') $('.nav-item').eq(4).addClass('active');
		}

		// ë‹¬ë€íŠ¸ ì¹´ìš´íŒ… ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
		function updateTalent(amount) {
			let $subDisplay = $('.sub-money, #user-level'); // ì„œë¸Œí˜ì´ì§€ìš©

			let startValue = currentTalent;
			let endValue = currentTalent + amount;

			$({val: startValue}).animate({val: endValue}, {
				duration: 800, // 0.8ì´ˆ ë™ì•ˆ ì• ë‹ˆë©”ì´ì…˜
				easing: 'swing',
				step: function () {
					// ìˆ«ìì— ì½¤ë§ˆ(,) ì¶”ê°€í•˜ë©° ì—…ë°ì´íŠ¸
					let formatted = Math.floor(this.val).toLocaleString();
					$subDisplay.text(formatted);
				},
				complete: function () {
					currentTalent = endValue;
					$subDisplay.text(currentTalent.toLocaleString());
				}
			});
		}

		// ì•Œë¦¼ì°½ ë„ìš°ê¸° í•¨ìˆ˜ (ë©”ì‹œì§€, ì•„ì´ì½˜, ì œëª©)
		function showAlert(msg, icon = 'âœ¨', title = 'ì•Œë¦¼') {
			$('#alert-message').html(msg);
			$('#alert-icon').html(icon);
			$('#alert-title').text(title);
			$('#custom-alert').addClass('active');
		}

		// ì•Œë¦¼ì°½ ë‹«ê¸° í•¨ìˆ˜
		function closeAlert() {
			$('#custom-alert').removeClass('active');
		}

		// --- ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì˜ˆì‹œ ---

		$(document).ready(function () {
			const targetExp = $('#current-exp').text(); // í˜„ì¬ 60 ë“±ìœ¼ë¡œ ì„¤ì •ëœ í…ìŠ¤íŠ¸ê°’ ì½ê¸°
			const totalExp = 100; // ìµœëŒ€ ê²½í—˜ì¹˜
			const percentage = (targetExp / totalExp) * 100;

			// 0ìœ¼ë¡œ ì´ˆê¸°í™”í–ˆë‹¤ê°€ 0.1ì´ˆ ë’¤ì— ëª©í‘œì¹˜ë¡œ ì„¤ì • (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ê·¹ëŒ€í™”)
			$('#exp-bar').css('width', '0%');
			setTimeout(() => {
				$('#exp-bar').css('width', percentage + '%');
			}, 100);

			// ë§ì”€ íƒ€ì´í•‘ íš¨ê³¼ë„ ì—¬ê¸°ì„œ í•¨ê»˜ ì‹¤í–‰í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.
			typeBible();


			// ë‚ ì§œ í‘œì‹œ
			$('#current-date').text(
				new Date().toLocaleDateString('ko-KR', {year: 'numeric', month: 'long', day: 'numeric'}));

			$('#stamp-zone').click(function () {
				if ($(this).hasClass('checked')) {
					showAlert('ì´ë¯¸ ì˜¤ëŠ˜ì˜ ì¶œì„ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!', 'ğŸ“…', 'ì•Œë¦¼');
					return;
				}

				// ìƒíƒœ ë³€ê²½
				$(this).addClass('checked').css({
					'background': '#FFF0F0',
					'border-color': '#FF6B6B'
				}).html('<img src="https://cdn-icons-png.flaticon.com/512/3585/3585145.png" style="width:100px;">');

				// ì˜¤ëŠ˜ ë‚ ì§œ ìŠ¬ë¡¯ë„ ì²´í¬ í‘œì‹œ (ìˆ˜ìš”ì¼ ì˜ˆì‹œ)
				$('.slot-circle.today').addClass('checked');

				showAlert('ì°¸ ì˜í–ˆì–´ìš”!<br>ì¶œì„ ë‹¬ë€íŠ¸ <b>+100P</b>ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!',
					'<img src="https://cdn.jsdelivr.net/gh/ysrim/bjcc_ss@main/images/attendance.png" style="width:80px;">', 'ì¶œì„ ì„±ê³µ!');

				//updateTalent(100);
			});

			// í€˜ìŠ¤íŠ¸ ì´ë²¤íŠ¸ (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©)
			$('.q-check').change(function () {
				const isChecked = $(this).is(':checked');
				$(this).parent().toggleClass('quest-done', isChecked);
				updateTalent(isChecked ? 50 : -50);
			});
			updateTalent(50);
		});

		// íƒ€ì´í•‘ íš¨ê³¼ìš© ë³€ìˆ˜
		const bibleText = "ë‚´ê²Œ ëŠ¥ë ¥ ì£¼ì‹œëŠ” ì ì•ˆì—ì„œ ë‚´ê°€ ëª¨ë“  ê²ƒì„ í•  ìˆ˜ ìˆëŠë‹ˆë¼";
		let typingIdx = 0;
		let isTyping = false; // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€

		function typeBible() {
			if (isTyping) return; // ì´ë¯¸ íƒ€ì´í•‘ ì¤‘ì´ë©´ ë¬´ì‹œ
			const $target = $('#typing-bible');
			$target.text(""); // ì´ˆê¸°í™”
			typingIdx = 0;
			isTyping = true;

			function typing() {
				if (typingIdx < bibleText.length) {
					$target.append(bibleText[typingIdx]);
					typingIdx++;
					setTimeout(typing, 100); // íƒ€ì´í•‘ ì†ë„ (100ms)
				} else {
					isTyping = false; // íƒ€ì´í•‘ ì™„ë£Œ
				}
			}

			typing();
		}

		function handleLogout() {
			location.href = 'intro.html';
		}

		// ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì²˜ë¦¬ í•¨ìˆ˜
		function handlePasswordChange() {
			const currentPw = $('#current-pw').val();
			const newPw = $('#new-pw').val();
			const newPwConfirm = $('#new-pw-confirm').val();

			// ê°„ë‹¨í•œ ìœ íš¨ì„± ê²€ì‚¬
			if (!currentPw || !newPw || !newPwConfirm) {
				showAlert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'âš ï¸', 'ì…ë ¥ ì˜¤ë¥˜');
				return;
			}

			if (newPw !== newPwConfirm) {
				showAlert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë¡œ ì¼ì¹˜í•˜ì§€ ì•Šì•„ìš”.', 'âŒ', 'í™•ì¸ ì‹¤íŒ¨');
				return;
			}

			if (newPw.length < 4) {
				showAlert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ìë¦¬ ì´ìƒìœ¼ë¡œ í•´ì£¼ì„¸ìš”!', 'ğŸ”‘', 'ë³´ì•ˆ ì•½í•¨');
				return;
			}

			// ë³€ê²½ ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜
			showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì•ˆì „í•˜ê²Œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!<br>ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ë³¼ê¹Œìš”?', 'âœ¨', 'ë³€ê²½ ì™„ë£Œ');

			// ì…ë ¥ì°½ ì´ˆê¸°í™” ë° ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
			$('#current-pw, #new-pw, #new-pw-confirm').val('');
			showPage('page-mypage');
		}
	</script>
</th:block>
</html>