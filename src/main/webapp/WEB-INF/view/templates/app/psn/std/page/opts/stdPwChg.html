<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/app/psn/std/layouts/std_layout}" lang="ko">
<th:block layout:fragment="content">
	<script src="/files/script/libs/qrcode.min.js"></script>
	<script th:inline="javascript">
        // [ì¶”ê°€] ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€ í•¨ìˆ˜
        function togglePwVisibility(inputId) {
            const $input = $('#' + inputId);
            const currentType = $input.attr('type');
            if (currentType === 'password') {
                $input.attr('type', 'text');
            } else {
                $input.attr('type', 'password');
            }
        }

        // [ìˆ˜ì •] ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë¡œì§ (ê¸°ëŠ¥ ê°•í™”)
        function handlePasswordChange() {
            const currentPw = $('#current-pw').val().trim();
            const newPw = $('#new-pw').val().trim();
            const newPwConfirm = $('#new-pw-confirm').val().trim();

            // 1. ì…ë ¥ í™•ì¸
            if (!currentPw) {
                _showAlert('ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!', 'âš ï¸', 'ì…ë ¥ í™•ì¸');
                $('#current-pw').focus();
                return;
            }
            if (!newPw) {
                _showAlert('ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!', 'âš ï¸', 'ì…ë ¥ í™•ì¸');
                $('#new-pw').focus();
                return;
            }

            // 2. ìœ íš¨ì„± ê²€ì‚¬ (ê¸¸ì´)
            if (newPw.length < 6) {
                _showAlert('ë³´ì•ˆì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ëŠ”<br><b>ìµœì†Œ 4ìë¦¬ ì´ìƒ</b>ì´ì–´ì•¼ í•´ìš”!', 'ğŸ›¡ï¸', 'ë³´ì•ˆ ì•½í•¨');
                $('#new-pw').focus();
                return;
            }

            // 3. ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
            if (newPw !== newPwConfirm) {
                _showAlert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë¡œ ë‹¬ë¼ìš”.<br>ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”!', 'âŒ', 'ë¶ˆì¼ì¹˜');
                $('#new-pw-confirm').val('').focus();
                return;
            }

            // 4. ê¸°ì¡´ ë¹„ë²ˆê³¼ ë™ì¼í•œì§€ ì²´í¬ (ì„ íƒ ì‚¬í•­)
            if (currentPw === newPw) {
                _showAlert('ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ì™€ ë˜‘ê°™ì•„ìš”.<br>ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¡œ ë°”ê¿”ì£¼ì„¸ìš”!', 'ğŸ”„', 'ë³€ê²½ í•„ìš”');
                return;
            }

            if (!$('#pw-strength-bar').hasClass("strength-safe")) {
                _showAlert('ë³´ì•ˆì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ëŠ”<br><b>ì˜ë¬¸ ìˆ«ì íŠ¹ìˆ˜ë¬¸ìí¬í•¨ 8ìë¦¬ ì´ìƒ</b>ì´ì–´ì•¼ í•´ìš”!', 'ğŸ›¡ï¸', 'ë³´ì•ˆ ì•½í•¨');
                return;
            }

            // ë¡œë”© íš¨ê³¼ (ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ)
            $.ajax({
                type: "POST",
                url: "/std/opts/pwChg.ax",
                data: {
                    currentPw: currentPw
                    , newPw: newPw
                },
                success: (data) => {
                    if (data.rtnCd === '001') {
                        setTimeout(() => {
                            _showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì•ˆì „í•˜ê²Œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!<br>ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.', 'âœ¨', 'ì„±ê³µ!');
                            $('#current-pw, #new-pw, #new-pw-confirm').val(''); // ì…ë ¥ì°½ ì´ˆê¸°í™”
                            setTimeout(() => {
                                location.href = "/std/idx/logOut.pg";
                            }, 1500);

                        }, 1000); // 1ì´ˆ ë”œë ˆì´ ì‹œë®¬ë ˆì´ì…˜
                    } else {
                        _showAlert(data.rtnMsg || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'ğŸ”¥', 'ì˜¤ë¥˜');
                    }
                },
                error: (e) => {
                    _showAlert('ì„œë²„ì™€ í†µì‹ ì´ ì›í™œí•˜ì§€ ì•Šì•„ìš”.', 'ğŸ˜¥', 'í†µì‹  ì¥ì• ');
                }
            });

        }

        // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì‹¤ì‹œê°„ ì²´í¬
        $(function () {
            $('#new-pw').on('input', function () {
                const pw = $(this).val();
                const $bar = $('#pw-strength-bar');
                const $text = $('#pw-strength-text');

                // 1. ì´ˆê¸°í™” (ì…ë ¥ ì—†ì„ ë•Œ)
                if (pw.length === 0) {
                    $bar.css('width', '0%').removeClass('strength-weak strength-normal strength-safe');
                    $text.text('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”').css('color', '#999');
                    return;
                }

                // 2. ì ìˆ˜ ê³„ì‚° ë¡œì§
                let score = 0;

                // ê¸¸ì´ ì²´í¬
                if (pw.length >= 4) score += 20;
                if (pw.length >= 8) score += 30;

                // ì¡°í•© ì²´í¬ (ì •ê·œì‹ í™œìš©)
                const hasNumber = /[0-9]/.test(pw);       // ìˆ«ì í¬í•¨
                const hasEng = /[a-zA-Z]/.test(pw);       // ì˜ë¬¸ í¬í•¨
                const hasSpecial = /[!@#$%^&*]/.test(pw); // íŠ¹ìˆ˜ë¬¸ì í¬í•¨

                if (hasNumber) score += 15;
                if (hasEng) score += 15;
                if (hasSpecial) score += 20;

                // 3. ì ìˆ˜ì— ë”°ë¥¸ ìƒíƒœ ë°˜ì˜
                $bar.removeClass('strength-weak strength-normal strength-safe');

                if (pw.length < 4) {
                    // ë„ˆë¬´ ì§§ìŒ (ì‚¬ìš© ë¶ˆê°€ ìˆ˜ì¤€)
                    $bar.css({'width': '20%', 'background-color': '#ff5252'});
                    $text.text('ë„ˆë¬´ ì§§ì•„ìš” (4ì ì´ìƒ)').css('color', '#ff5252');
                } else if (score < 50) {
                    // ì•½í•¨
                    $bar.addClass('strength-weak').css('width', '40%');
                    $text.text('âš ï¸ ì•½í•¨ (ìˆ«ìë‚˜ ê¸°í˜¸ë¥¼ ì„ì–´ë³´ì„¸ìš”)').css('color', '#ff5252');
                } else if (score < 99) {
                    // ë³´í†µ
                    $bar.addClass('strength-normal').css('width', '70%');
                    $text.text('ğŸ™‚ ì ë‹¹í•¨').css('color', '#ffb142');
                } else if (score = 100) {
                    // ì•ˆì „
                    $bar.addClass('strength-safe').css('width', '100%');
                    $text.text('ğŸ›¡ï¸ ì•„ì£¼ íŠ¼íŠ¼í•´ìš”!').css('color', '#2cc990');
                }
            });
        });
	</script>
	<div style="margin: 25px 25px 10px 25px; display: flex; align-items: center;">
		<div style="width: 4px; height: 16px; background-color: #4A90E2; border-radius: 2px; margin-right: 10px;"></div>
		<h3 style="margin: 0; font-size: 1.15rem; color: #333; font-weight: 800;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
	</div>
	<div class="card" style="margin-top: 20px;">
		<div class="text-center mb-25">
			<div style="font-size: 3rem; margin-bottom: 10px;">ğŸ”</div>
			<p class="text-sub">ì•ˆì „í•œ ëª¨í—˜ì„ ìœ„í•´<br>ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•´ ì£¼ì„¸ìš”!</p>
		</div>

		<div class="mb-15">
			<label class="text-bold text-light mb-5" style="font-size:0.8rem; display:block; margin-left:5px;">ê¸°ì¡´
				ë¹„ë°€ë²ˆí˜¸</label>
			<div class="pw-input-wrapper">
				<input type="password" id="current-pw" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
				<button class="btn-pw-toggle" onclick="togglePwVisibility('current-pw')">ğŸ‘ï¸</button>
			</div>
		</div>

		<div class="mb-15">
			<label class="text-bold text-light mb-5" style="font-size:0.8rem; display:block; margin-left:5px;">ìƒˆ
				ë¹„ë°€ë²ˆí˜¸</label>
			<div class="pw-input-wrapper">
				<input type="password" id="new-pw" placeholder="4ìë¦¬ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”">
				<button class="btn-pw-toggle" onclick="togglePwVisibility('new-pw')">ğŸ‘ï¸</button>
			</div>
			<div class="pw-strength-container">
				<div class="strength-bar-bg">
					<div id="pw-strength-bar" class="strength-bar-fill"></div>
				</div>
				<span id="pw-strength-text" class="strength-text">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”</span>
			</div>
		</div>

		<div class="mb-25">
			<label class="text-bold text-light mb-5" style="font-size:0.8rem; display:block; margin-left:5px;">ìƒˆ ë¹„ë°€ë²ˆí˜¸
				í™•ì¸</label>
			<div class="pw-input-wrapper">
				<input type="password" id="new-pw-confirm" placeholder="í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”">
				<button class="btn-pw-toggle" onclick="togglePwVisibility('new-pw-confirm')">ğŸ‘ï¸</button>
			</div>
		</div>

		<button class="btn btn-main" onclick="handlePasswordChange()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ</button>
	</div>
</th:block>
</html>